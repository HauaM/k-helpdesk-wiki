- **목적:** 특정 메뉴얼 항목의 `business_type`/`error_code`를 기준으로 동일 논리키를 가진 `APPROVED` 메뉴얼 목록을 반환하기 위함
- **유형:** ✅ 신규
- **공통 API 활용:** 이 엔드포인트는 공통 예외/응답 구조를 제공하는 `app/routers/common_codes.py`(Common API) 또는 유사한 공유 레이어를 반드시 경유하여 구성해야 함. 신규 라우터는 해당 `APIRouter`에 포함시키거나, 공통 핸들러/DTO를 재사용하도록 설계.
- **핵심 요구사항:**
  - 입력: `manual_id` (UUID)
  - 출력: `ManualEntryResponse` 리스트 (각 항목의 `business_type_name` 포함)
  - 예외/제약:
    - `manual_id`에 해당하는 메뉴얼을 찾을 수 없으면 `404`
    - 조회한 메뉴얼에 `business_type` 또는 `error_code`가 존재하지 않으면 `400`
    - 조건을 만족하는 `APPROVED` 메뉴얼이 없어도 빈 리스트 반환
  - 처리흐름 요약: ID → 업무코드/에러코드 획득 → `APPROVED` 상태로 동일 그룹 메뉴얼 조회 → 응답 스키마로 변환

## 2. 구현 대상 파일

| 구분 | 경로 | 설명 |
| ---- | ---- | ---- |
| 변경 | `app/routers/manuals.py` | `GET /manuals/{manual_id}/approved-group` 핸들러 추가 및 에러 매핑 |
| 변경 | `app/services/manual_service.py` | `ManualService`에 그룹 조회 메서드 추가하고 `business_type_name` 매핑 포함 |
| 참조 | `app/repositories/manual_rdb.py` | `find_all_approved_by_group` 재사용하여 `APPROVED` 항목 확보 |

## 3. 동작 플로우 (Mermaid)

```mermaid
flowchart TD
    A[Client] -->|GET /manuals/{id}/approved-group| B[Router]
    B --> C[ManualService.get_approved_group_by_manual_id]
    C --> D[ManualEntryRDBRepository.find_all_approved_by_group]
    D --> E[ManualEntryResponse 리스트 + business_type_name]
    E --> F[API Response]
```

## 4. 테스트 계획

### 4.1 원칙
- 서비스 단위에서 입력 검증, 공통코드 매핑, `APPROVED` 필터링을 검증
- API 단위에서는 HTTP 상태/사양을 유지하는지 검증
- 외부 의존(DB, 공통코드) 은 AsyncSession/모킹으로 대체

### 4.2 구현 예상 테스트 항목

| TC ID | 계층 | 시나리오 | 목적 | 입력/사전조건 | 기대결과 |
| ----- | ---- | -------- | ---- | ------------- | -------- |
| TC-API-001 | API | 정상: ID로 조회 | 그룹 응답/200 확인 | `manual_id` 존재, business_type/error_code 있음 | `200`, `ManualEntryResponse` 리스트, `business_type_name` 존재 |
| TC-API-002 | API | ID 미존재 | 404 매핑 확인 | DB에 없는 `manual_id` | `404 Not Found`, 메시지 |
| TC-SVC-003 | Unit | business_type 또는 error_code 없음 | 입력 검증 예외 | `ManualEntry`의 key 미존재 | `ValidationError` 또는 `BusinessLogicError` → `400` |
| TC-SVC-004 | Unit | Approved 그룹 가져오기 | Repository 호출/매핑 검증 | 일치하는 `business_type`/`error_code` + `APPROVED` 항목 존재 | 매핑된 `ManualEntryResponse` 리스트 |

## 6. 예상 요청/응답

### 6.1 요청

```
GET /api/v1/manuals/3c4a6bbf-6d3a-4f6c-92cb-7e1e7ab2f0f9/approved-group
```

### 6.2 정상 응답 (동일 그룹 `APPROVED` 메뉴얼 존재)

```json
[
  {
    "id": "3c4a6bbf-6d3a-4f6c-92cb-7e1e7ab2f0f9",
    "keywords": ["로그인", "인증"],
    "topic": "로그인 실패 시 대응",
    "background": "인증 서버 장애로 N건 이상 발생",
    "guideline": "1. ...",
    "business_type": "INTERNET_BANKING",
    "error_code": "E001",
    "source_consultation_id": "d9af8c29-3b07-4b71-9ef1-5b2c7a7890f4",
    "version_id": "23b7a2d1-1d38-4f28-b5f3-2d9c5d7d4fce",
    "status": "APPROVED",
    "business_type_name": "인터넷뱅킹",
    "created_at": "2025-12-10T08:00:00Z",
    "updated_at": "2025-12-11T09:12:00Z"
  },
  {
    "id": "5eecac0d-6cb3-4b5a-9e2b-6a5d32fd3447",
    "keywords": ["인증", "보안"],
    "topic": "로그인 오류 대응",
    "background": "더 많은 사용자 문의",
    "guideline": "1. ...",
    "business_type": "INTERNET_BANKING",
    "error_code": "E001",
    "source_consultation_id": "f1e0828b-96c2-4955-9ee2-13c1d1f5c0e5",
    "version_id": "5f1d8fde-13c3-4b10-95a4-9e432d41f4fc",
    "status": "APPROVED",
    "business_type_name": "인터넷뱅킹",
    "created_at": "2025-12-09T07:32:00Z",
    "updated_at": "2025-12-09T08:00:00Z"
  }
]
```

### 6.3 오류 응답 예시

- `manual_id` 미존재

```json
{
  "detail": "ManualEntry(id=00000000-0000-0000-0000-000000000000) not found"
}
```

- `business_type`/`error_code` 누락

```json
{
  "detail": "ManualEntry(id=3c4a6bbf-6d3a-4f6c-92cb-7e1e7ab2f0f9) has no business_type or error_code"
}
```

## 5. 사용자 요청 기록

### 원본 요청 (1차)
```
[manuals.py](app/routers/manuals.py) 에 API를 추가하기 위해 프로젝트를 분석후 나의 요구사항에 맞는 API를 만들어줘.

[배경]
프론트 엔드에서 메뉴얼중 같은 논리키(업무구분, 에러코드)를 갖고 있는 메뉴얼의 상세내역을 전체로 확인하기 위함

[요구사항]
`manual_entries` 의 id를 파라미터로 입력 받음.
입력받은 id를 기준으로 업무 코드와, 에러코드를 파악함.
해당 manual과 같은 업무 코드와, 에러코드를 갖고 있으며 상태가 `APPROVED`인 데이터의 상세 데이터들을 리스트 형태로 받음.
```

### Claude 분석 (필요시)
```
N/A
```

### 사용자 명확화 (2차+)
```
없음
```

### 최종 확정 (체크리스트)
- ✅ 입력은 `manual_id`, 출력은 동일 그룹 `APPROVED` 리스트
- ✅ `business_type`/`error_code` 누락 시 예외 처리
- ✅ `business_type_name`을 공통코드에서 매핑하여 응답에 포함
