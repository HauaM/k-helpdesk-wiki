# Unit Spec

## 1. 요구사항 요약

- **목적:** 부서(Department) 정보를 PUT 메서드로 수정하기 위한 API 추가
- **유형:** 변경
- **핵심 요구사항:**
  - 입력: `department_id`(경로), 수정할 부서 데이터(본문)
  - 출력: 수정된 부서 데이터(JSON)
  - 예외/제약: 대상 없음 시 404, 유효성 실패 시 400, 부서코드 중복 시 400
  - 처리흐름 요약: 라우터 → 서비스 → 저장소 → DB 업데이트 후 응답

---

## 2. 구현 대상 파일

| 구분 | 경로 | 설명 |
| ---- | ---- | ---- |
| 변경 | app/routers/departments.py | PUT 엔드포인트 추가 |
| 변경 | app/services/department_service.py | 수정 로직 추가 |
| 변경 | app/repositories/department_repository.py | 업데이트 쿼리 추가 |
| 참조 | app/schemas/department.py | 요청/응답 스키마 참조 |
| 참조 | app/models/department.py | 모델 참조 |

---

## 3. 동작 플로우 (Mermaid)

```mermaid
flowchart TD
    A[Client] -->|PUT /admin/departments/{department_id}| B(API Router)
    B --> C[Service Layer]
    C --> D[Repository Layer]
    D --> E[Database]
    E --> F[Response]
```

---

## 4. 테스트 계획

### 4.1 원칙

- **테스트 우선(TDD)**: 본 섹션의 항목을 우선 구현하고 코드 작성.
- **계층별 커버리지**: Unit → Integration → API(E2E-lite) 순서로 최소 P0 커버.
- **독립성/재현성**: 외부 연동은 모킹.
- **판정 기준**: 상태코드/스키마/부작용(저장)을 명시적으로 검증.

### 4.2 구현 예상 테스트 항목(각 항목의 목적 포함)

| TC ID | 계층 | 시나리오 | 목적(무엇을 검증?) | 입력/사전조건 | 기대결과 |
| --- | --- | --- | --- | --- | --- |
| TC-API-001 | API | 정상 수정 | API 계약/상태코드/응답 스키마 검증 | 유효한 PUT 요청 | `200`, 수정된 필드 반영 |
| TC-API-002 | API | 대상 없음 | 404 매핑 검증 | 없는 `department_id` | `404`, 에러 메시지 |
| TC-API-003 | API | 입력 누락 | 입력 검증 및 오류 매핑 | 필수 필드 누락 | `400`, 검증 에러 |
| TC-SVC-004 | Unit | 서비스 로직 | 로직 정합성/호출 검증 | 모킹된 repo | 업데이트 호출/결과 반환 |

---

## 5. 사용자 요청 기록

### 원본 요청 (1차)
```
[departments.py](app/routers/departments.py) 에 PUT 메서드로 department의 데이터를 수정하는 API를 추가해줘. 
모든 데이터는 한글로.
```

### Claude 분석 (필요시)
```
스키마/서비스/레포 구조 확인 후 PUT 엔드포인트 및 업데이트 로직 추가 필요
```

### 사용자 명확화 (2차+)
```
승인
```

### 최종 확정 (체크리스트)
- ✅ PUT 부서 수정 API 추가
- ✅ 응답/에러 처리 규칙 반영
- ✅ 한국어 메시지 유지
